{"version":3,"file":"index.mjs","sources":["../node_modules/debug/src/index.js","../lib/delay.js","../lib/clear_timeout.js","../lib/clear_pending.js","../lib/async.js","../lib/sync.js","../lib/index.js"],"sourcesContent":["/**\n * Detect Electron renderer process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process !== 'undefined' && process.type === 'renderer') {\n  module.exports = require('./browser.js');\n} else {\n  module.exports = require('./node.js');\n}\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar pow = require( '@stdlib/math-base-special-pow' );\n\n\n// MAIN //\n\n/**\n* Computes an exponential delay.\n*\n* @private\n* @param {NonNegativeInteger} retries - number of retries\n* @param {number} max - maximum delay\n* @returns {NonNegativeInteger} exponential delay\n*/\nfunction delay( retries, max ) {\n\tvar d = pow( 2, retries ) - 1;\n\tif ( d > max ) {\n\t\td = max;\n\t}\n\treturn d;\n}\n\n\n// EXPORTS //\n\nmodule.exports = delay;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// EXPORTS //\n\nmodule.exports = clearTimeout;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar objectKeys = require( '@stdlib/utils-keys' );\nvar cancelTimeout = require( './clear_timeout.js' );\n\n\n// MAIN //\n\n/**\n* Clears pending timeouts.\n*\n* @private\n* @param {Object} pending - hash containing pending timeout ids\n*/\nfunction clearPending( pending ) {\n\tvar keys;\n\tvar i;\n\tkeys = objectKeys( pending );\n\tfor ( i = 0; i < keys.length; i++ ) {\n\t\tcancelTimeout( pending[ keys[i] ] );\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = clearPending;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar logger = require( 'debug' );\nvar isStringArray = require( '@stdlib/assert-is-string-array' ).primitives;\nvar isFunction = require( '@stdlib/assert-is-function' );\nvar copy = require( '@stdlib/utils-copy' );\nvar readFile = require( '@stdlib/fs-read-file' );\nvar format = require( '@stdlib/string-format' );\nvar config = require( './config.json' );\nvar delay = require( './delay.js' );\nvar clearPending = require( './clear_pending.js' );\n\n\n// VARIABLES //\n\nvar debug = logger( 'read-file-list:async' );\nvar MAX_RETRIES = config.max_retries;\nvar MAX_DELAY = config.max_delay;\n\n\n// MAIN //\n\n/**\n* Asynchronously reads the entire contents of each file in a file list.\n*\n* @param {StringArray} list - list of file paths\n* @param {(Object|string)} [options] - options\n* @param {(string|null)} [options.encoding] - file encoding\n* @param {string} [options.flag] - file status flag\n* @param {Function} clbk - callback to invoke after reading file contents\n* @throws {TypeError} first argument must be a string array\n* @throws {TypeError} callback argument must be a function\n*\n* @example\n* var list = [ __filename ];\n*\n* readFileList( list, onFiles );\n*\n* function onFiles( error, files ) {\n*     if ( error ) {\n*         throw error;\n*     }\n*     console.dir( files );\n* }\n*/\nfunction readFileList( list, options, clbk ) {\n\tvar pending;\n\tvar results;\n\tvar errFLG;\n\tvar count;\n\tvar opts;\n\tvar len;\n\tvar cb;\n\tvar i;\n\n\tif ( !isStringArray( list ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. First argument must be a string array. Value: `%s`.', list ) );\n\t}\n\tif ( arguments.length < 3 ) {\n\t\topts = {};\n\t\tcb = options;\n\t} else {\n\t\topts = copy( options );\n\t\tcb = clbk;\n\t}\n\tif ( !isFunction( cb ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. Callback argument must be a function. Value: `%s`.', cb ) );\n\t}\n\tlen = list.length;\n\n\tresults = new Array( len );\n\tpending = {};\n\tcount = 0;\n\n\tdebug( 'Reading %d files...', len );\n\tfor ( i = 0; i < len; i++ ) {\n\t\tdebug( 'Reading file: %s (%d of %d).', list[ i ], i+1, len );\n\t\treadFile( list[ i ], opts, getCallback( i ) );\n\t}\n\n\t/**\n\t* Returns a callback to be invoked upon reading a file.\n\t*\n\t* @private\n\t* @param {NonNegativeInteger} idx - index\n\t* @returns {Callback} callback\n\t*/\n\tfunction getCallback( idx ) {\n\t\tvar retries;\n\t\tvar file;\n\t\tvar k;\n\n\t\tfile = list[ idx ];\n\t\tk = idx + 1;\n\t\tretries = 0;\n\n\t\t/**\n\t\t* Retries reading a file.\n\t\t*\n\t\t* @private\n\t\t*/\n\t\tfunction retry() {\n\t\t\tdelete pending[ idx ];\n\t\t\tdebug( 'Reading file: %s (%d of %d). Retry: %d of %d.', file, k, len, retries, MAX_RETRIES );\n\t\t\treadFile( file, opts, onRead );\n\t\t}\n\n\t\t/**\n\t\t* Callback to be invoked upon reading a file.\n\t\t*\n\t\t* @private\n\t\t* @param {(Error|null)} error - error object\n\t\t* @param {(Buffer|string)} data - file data\n\t\t* @returns {void}\n\t\t*/\n\t\tfunction onRead( error, data ) {\n\t\t\tvar d;\n\t\t\tif ( errFLG ) {\n\t\t\t\tdebug( 'An error has already been returned. Discarding data for file: %s (%d of %d).', file, k, len );\n\t\t\t\treturn; // prevents `done()` from being called more than once\n\t\t\t}\n\t\t\tif ( error ) {\n\t\t\t\tdebug( 'Encountered an error when reading %s (%d of %d). Error: %s', file, k, len, error.message );\n\t\t\t\tif (\n\t\t\t\t\terror.code === 'EMFILE' || // current process\n\t\t\t\t\terror.code === 'ENFILE'    // across entire system\n\t\t\t\t) {\n\t\t\t\t\tretries += 1;\n\t\t\t\t\tif ( retries > MAX_RETRIES ) {\n\t\t\t\t\t\tdebug( 'Maximum number of retries exceeded. Too many open files.' );\n\t\t\t\t\t\terror = new Error( 'max retries exceeded. Too many open files.' );\n\t\t\t\t\t\treturn done( error );\n\t\t\t\t\t}\n\t\t\t\t\td = delay( retries, MAX_DELAY );\n\t\t\t\t\tdebug( 'Too many open files. Will retry reading file %d of %d in %s seconds.', k, len, d/1000 );\n\t\t\t\t\tpending[ idx ] = setTimeout( retry, d );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn done( error );\n\t\t\t}\n\t\t\tdebug( 'Successfully read file: %s (%d of %d).', file, k, len );\n\t\t\tresults[ idx ] = {\n\t\t\t\t'file': file,\n\t\t\t\t'data': data\n\t\t\t};\n\t\t\tcount += 1;\n\t\t\tdebug( 'Read %d of %d files.', count, len );\n\t\t\tif ( count === len ) {\n\t\t\t\treturn done();\n\t\t\t}\n\t\t}\n\n\t\treturn onRead;\n\t}\n\n\t/**\n\t* Callback invoked upon completion.\n\t*\n\t* @private\n\t* @param {Error} [error] - error object\n\t* @returns {void}\n\t*/\n\tfunction done( error ) {\n\t\tclearPending( pending );\n\t\tif ( error ) {\n\t\t\terrFLG = true;\n\t\t\treturn cb( error );\n\t\t}\n\t\tdebug( 'Successfully read all files.' );\n\t\tcb( null, results );\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = readFileList;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar logger = require( 'debug' );\nvar readFile = require( '@stdlib/fs-read-file' ).sync;\nvar isStringArray = require( '@stdlib/assert-is-string-array' ).primitives;\nvar format = require( '@stdlib/string-format' );\n\n\n// VARIABLES //\n\nvar debug = logger( 'read-file-list:sync' );\n\n\n// MAIN //\n\n/**\n* Synchronously reads the entire contents of each file in a file list.\n*\n* @param {StringArray} list - list of file paths\n* @param {(Object|string)} [options] - options\n* @param {(string|null)} [options.encoding] - file encoding\n* @param {string} [options.flag] - file status flag\n* @throws {TypeError} must provide a string array\n* @returns {ObjectArray} file contents\n*\n* @example\n* var list = [ __filename ];\n* var files = readFileListSync( list );\n*\n* if ( files instanceof Error ) {\n*     throw files;\n* }\n* console.dir( files );\n*/\nfunction readFileListSync( list, options ) {\n\tvar results;\n\tvar opts;\n\tvar file;\n\tvar len;\n\tvar i;\n\n\tif ( !isStringArray( list ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. First argument must be a string array. Value: `%s`.', list ) );\n\t}\n\tif ( arguments.length > 1 ) {\n\t\topts = options;\n\t} else {\n\t\topts = {};\n\t}\n\tlen = list.length;\n\tresults = new Array( len );\n\n\tdebug( 'Reading %d files...', len );\n\tfor ( i = 0; i < len; i++ ) {\n\t\tdebug( 'Reading file: %s (%d of %d).', list[ i ], i+1, len );\n\t\tfile = readFile( list[ i ], opts );\n\t\tif ( file instanceof Error ) {\n\t\t\tdebug( 'Encountered an error when reading file: %s (%d of %d). Error: %s', list[ i ], i, len, file.message );\n\t\t\treturn file;\n\t\t}\n\t\tdebug( 'Successfully read file: %s (%d of %d).', list[ i ], i, len );\n\t\tresults[ i ] = {\n\t\t\t'file': list[ i ],\n\t\t\t'data': file\n\t\t};\n\t}\n\tdebug( 'Finished reading files.' );\n\treturn results;\n}\n\n\n// EXPORTS //\n\nmodule.exports = readFileListSync;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n/**\n* Read the entire contents of each file in a file list.\n*\n* @module @stdlib/fs-read-file-list\n*\n* @example\n* var readFileList = require( '@stdlib/fs-read-file-list' );\n*\n* var list = [ __filename ];\n*\n* readFileList( list, onFiles );\n*\n* function onFiles( error, files ) {\n*     if ( error ) {\n*         throw error;\n*     }\n*     console.dir( files );\n* }\n*\n* @example\n* var readFileList = require( '@stdlib/fs-read-file-list' ).sync;\n*\n* var list = [ __filename ];\n* var files = readFileList( list );\n*\n* if ( files instanceof Error ) {\n*     throw files;\n* }\n* console.dir( files );\n*/\n\n// MODULES //\n\nvar setReadOnly = require( '@stdlib/utils-define-nonenumerable-read-only-property' );\nvar readFileList = require( './async.js' );\nvar sync = require( './sync.js' );\n\n\n// MAIN //\n\nsetReadOnly( readFileList, 'sync', sync );\n\n\n// EXPORTS //\n\nmodule.exports = readFileList;\n"],"names":["module","exports","process","type","require","pow","require$$0","delay_1","retries","max","d","clear_timeout","clearTimeout","objectKeys","cancelTimeout","require$$1","clear_pending","pending","keys","i","length","logger","isStringArray","primitives","isFunction","require$$2","copy","require$$3","readFile","require$$4","format","require$$5","config","require$$6","delay","require$$7","clearPending","require$$8","debug","MAX_RETRIES","max_retries","MAX_DELAY","max_delay","async","list","options","clbk","results","errFLG","count","opts","len","cb","TypeError","arguments","Array","getCallback","idx","file","k","retry","onRead","error","data","message","code","done","Error","setTimeout","sync","readFileList","lib"],"mappings":"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"}