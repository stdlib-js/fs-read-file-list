// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import{primitives as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import s,{sync as i}from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-read-file@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";function l(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var n=function e(){if(this instanceof e){var n=[null];n.push.apply(n,arguments);var t=Function.bind.apply(r,n);return new t}return r.apply(this,arguments)};n.prototype=r.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})})),n}var a=l(Object.freeze({__proto__:null,default:()=>()=>{}})),u=100,c=18e5;function m(e,r){var n=d(2,e)-1;return n>r&&(n=r),n}var p=clearTimeout;function h(e){var r,n;for(r=f(e),n=0;n<r.length;n++)p(e[r[n]])}var y=a("read-file-list:async"),g=u,j=c;function v(e,i,d){var f,l,a,u,c,p,v,b;if(!r(e))throw new TypeError(o("0C1CX",e));if(arguments.length<3?(c={},v=i):(c=t(i),v=d),!n(v))throw new TypeError(o("0C12n",v));for(p=e.length,l=new Array(p),f={},u=0,y("Reading %d files...",p),b=0;b<p;b++)y("Reading file: %s (%d of %d).",e[b],b+1,p),s(e[b],c,w(b));function w(r){var n,t,i;function o(){delete f[r],y("Reading file: %s (%d of %d). Retry: %d of %d.",t,i,p,n,g),s(t,c,d)}function d(e,s){var d;if(!a)return e?(y("Encountered an error when reading %s (%d of %d). Error: %s",t,i,p,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>g?(y("Maximum number of retries exceeded. Too many open files."),x(e=new Error("unexpected error. Max retries exceeded. Too many open files."))):(d=m(n,j),y("Too many open files. Will retry reading file %d of %d in %s seconds.",i,p,d/1e3),void(f[r]=setTimeout(o,d))):x(e)):(y("Successfully read file: %s (%d of %d).",t,i,p),l[r]={file:t,data:s},y("Read %d of %d files.",u+=1,p),u===p?x():void 0);y("An error has already been returned. Discarding data for file: %s (%d of %d).",t,i,p)}return t=e[r],i=r+1,n=0,d}function x(e){if(h(f),e)return a=!0,v(e);y("Successfully read all files."),v(null,l)}}var b=a("read-file-list:sync");function w(e,n){var t,s,d,f,l;if(!r(e))throw new TypeError(o("0C1CX",e));for(s=arguments.length>1?n:{},f=e.length,t=new Array(f),b("Reading %d files...",f),l=0;l<f;l++){if(b("Reading file: %s (%d of %d).",e[l],l+1,f),(d=i(e[l],s))instanceof Error)return b("Encountered an error when reading file: %s (%d of %d). Error: %s",e[l],l,f,d.message),d;b("Successfully read file: %s (%d of %d).",e[l],l,f),t[l]={file:e[l],data:d}}return b("Finished reading files."),t}e(v,"sync",w);export{v as default,w as sync};
//# sourceMappingURL=index.mjs.map
