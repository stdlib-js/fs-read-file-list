// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-read-file@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";function l(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var d="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function f(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}var c=f,m=u;function h(e){if(c===setTimeout)return setTimeout(e,0);if((c===f||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(r){try{return c.call(null,e,0)}catch(r){return c.call(this,e,0)}}}"function"==typeof d.setTimeout&&(c=setTimeout),"function"==typeof d.clearTimeout&&(m=clearTimeout);var p,g=[],v=!1,y=-1;function w(){v&&p&&(v=!1,p.length?g=p.concat(g):y=-1,g.length&&b())}function b(){if(!v){var e=h(w);v=!0;for(var r=g.length;r;){for(p=g,g=[];++y<r;)p&&p[y].run();y=-1,r=g.length}p=null,v=!1,function(e){if(m===clearTimeout)return clearTimeout(e);if((m===u||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(e);try{m(e)}catch(r){try{return m.call(null,e)}catch(r){return m.call(this,e)}}}(e)}}function j(e,r){this.fun=e,this.array=r}j.prototype.run=function(){this.fun.apply(null,this.array)};function T(){}var x=T,E=T,_=T,R=T,k=T,M=T,O=T;var A=d.performance||{},D=A.now||A.mozNow||A.msNow||A.oNow||A.webkitNow||function(){return(new Date).getTime()};var F=new Date;var L={nextTick:function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];g.push(new j(e,r)),1!==g.length||v||h(b)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:x,addListener:E,once:_,off:R,removeListener:k,removeAllListeners:M,emit:O,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var r=.001*D.call(A),t=Math.floor(r),n=Math.floor(r%1*1e9);return e&&(t-=e[0],(n-=e[1])<0&&(t--,n+=1e9)),[t,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-F)/1e3}};module.exports=void 0!==L&&"renderer"===L.type?require("./browser.js"):require("./node.js");var N=l(Object.freeze({__proto__:null})),P={max_retries:100,max_delay:18e5},S=s;var V=function(e,r){var t=S(2,e)-1;return t>r&&(t=r),t},q=clearTimeout,z=a,I=q;var C=function(e){var r,t;for(r=z(e),t=0;t<r.length;t++)I(e[r[t]])},W=N,B=r.primitives,G=t,H=n,J=i,K=o,Q=P,U=V,X=C,Y=W("read-file-list:async"),Z=Q.max_retries,$=Q.max_delay;var ee=function(e,r,t){var n,i,o,s,a,l,d,f;if(!B(e))throw new TypeError(K("invalid argument. First argument must be a string array. Value: `%s`.",e));if(arguments.length<3?(a={},d=r):(a=H(r),d=t),!G(d))throw new TypeError(K("invalid argument. Callback argument must be a function. Value: `%s`.",d));for(l=e.length,i=new Array(l),n={},s=0,Y("Reading %d files...",l),f=0;f<l;f++)Y("Reading file: %s (%d of %d).",e[f],f+1,l),J(e[f],a,u(f));function u(r){var t,d,f;function u(){delete n[r],Y("Reading file: %s (%d of %d). Retry: %d of %d.",d,f,l,t,Z),J(d,a,m)}function m(e,a){var m;if(!o)return e?(Y("Encountered an error when reading %s (%d of %d). Error: %s",d,f,l,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(t+=1)>Z?(Y("Maximum number of retries exceeded. Too many open files."),c(e=new Error("max retries exceeded. Too many open files."))):(m=U(t,$),Y("Too many open files. Will retry reading file %d of %d in %s seconds.",f,l,m/1e3),void(n[r]=setTimeout(u,m))):c(e)):(Y("Successfully read file: %s (%d of %d).",d,f,l),i[r]={file:d,data:a},Y("Read %d of %d files.",s+=1,l),s===l?c():void 0);Y("An error has already been returned. Discarding data for file: %s (%d of %d).",d,f,l)}return d=e[r],f=r+1,t=0,m}function c(e){if(X(n),e)return o=!0,d(e);Y("Successfully read all files."),d(null,i)}},re=N,te=i.sync,ne=r.primitives,ie=o,oe=re("read-file-list:sync");var se=ee,ae=function(e,r){var t,n,i,o,s;if(!ne(e))throw new TypeError(ie("invalid argument. First argument must be a string array. Value: `%s`.",e));for(n=arguments.length>1?r:{},o=e.length,t=new Array(o),oe("Reading %d files...",o),s=0;s<o;s++){if(oe("Reading file: %s (%d of %d).",e[s],s+1,o),(i=te(e[s],n))instanceof Error)return oe("Encountered an error when reading file: %s (%d of %d). Error: %s",e[s],s,o,i.message),i;oe("Successfully read file: %s (%d of %d).",e[s],s,o),t[s]={file:e[s],data:i}}return oe("Finished reading files."),t};e(se,"sync",ae);var le=se;export{le as default,ae as sync};
//# sourceMappingURL=index.mjs.map
