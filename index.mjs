// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import{primitives as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.0.8-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import s,{sync as i}from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-read-file@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.0.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";function l(e,r){var n=d(2,e)-1;return n>r&&(n=r),n}var a=clearTimeout;function m(e){var r,n;for(r=f(e),n=0;n<r.length;n++)a(e[r[n]])}var c=()=>{},p=100,u=18e5;function h(e,i,d){var f,a,h,j,g,v,y,E;if(!r(e))throw new TypeError(o("0C1CX",e));if(arguments.length<3?(g={},y=i):(g=t(i),y=d),!n(y))throw new TypeError(o("0C12n",y));for(v=e.length,a=new Array(v),f={},j=0,E=0;E<v;E++)c("Reading file: %s (%d of %d).",e[E],E+1,v),s(e[E],g,w(E));function w(r){var n,t,i;function o(){delete f[r],s(t,g,d)}function d(e,s){var d;if(!h)return e?(c("Encountered an error when reading %s (%d of %d). Error: %s",t,i,v,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>p?x(e=new Error("unexpected error. Max retries exceeded. Too many open files.")):(d=l(n,u),void(f[r]=setTimeout(o,d))):x(e)):(a[r]={file:t,data:s},(j+=1)===v?x():void 0)}return t=e[r],i=r+1,n=0,d}function x(e){if(m(f),e)return h=!0,y(e);y(null,a)}}var j=()=>{};function g(e,n){var t,s,d,f,l;if(!r(e))throw new TypeError(o("0C1CX",e));for(s=arguments.length>1?n:{},f=e.length,t=new Array(f),l=0;l<f;l++){if(j("Reading file: %s (%d of %d).",e[l],l+1,f),(d=i(e[l],s))instanceof Error)return j("Encountered an error when reading file: %s (%d of %d). Error: %s",e[l],l,f,d.message),d;j("Successfully read file: %s (%d of %d).",e[l],l,f),t[l]={file:e[l],data:d}}return t}e(h,"sync",g);export{h as default,g as sync};
//# sourceMappingURL=index.mjs.map
