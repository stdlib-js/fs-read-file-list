// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import{primitives as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.2.2-esm/index.mjs";import{isPrimitive as t}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.2.2-esm/index.mjs";import i,{sync as o}from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-read-file@v0.2.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@v0.3.0-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@v0.2.2-esm/index.mjs";function a(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var t=function e(){return this instanceof e?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})})),t}var c=a(Object.freeze({__proto__:null,default:()=>()=>{}})),u=100,m=18e5;var p=clearTimeout;var h=c("read-file-list:async"),v=u,g=m;function j(e,o,a){var c,u,m,j,y,b,E,w;if(!r(e))throw new TypeError(d("0OD3s",e));if(arguments.length<3?(y={},E=o):(y=t(o)?o:n({},o),E=a),!s(E))throw new TypeError(d("0OD2b",E));for(b=e.length,u=new Array(b),c={},j=0,h("Reading %d files...",b),w=0;w<b;w++)h("Reading file: %s (%d of %d).",e[w],w+1,b),i(e[w],y,x(w));function x(r){var t,s,n;function o(){delete c[r],h("Reading file: %s (%d of %d). Retry: %d of %d.",s,n,b,t,v),i(s,y,l)}function l(e,i){var l;if(!m)return e?(h("Encountered an error when reading %s (%d of %d). Error: %s",s,n,b,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(t+=1)>v?(h("Maximum number of retries exceeded. Too many open files."),O(e=new Error(d("0OD0H")))):(l=function(e,r){var t=f(2,e)-1;return t>r&&(t=r),t}(t,g),h("Too many open files. Will retry reading file %d of %d in %s seconds.",n,b,l/1e3),void(c[r]=setTimeout(o,l))):O(e)):(h("Successfully read file: %s (%d of %d).",s,n,b),u[r]={file:s,data:i},h("Read %d of %d files.",j+=1,b),j===b?O():void 0);h("An error has already been returned. Discarding data for file: %s (%d of %d).",s,n,b)}return s=e[r],n=r+1,t=0,l}function O(e){if(function(e){var r,t;for(r=l(e),t=0;t<r.length;t++)p(e[r[t]])}(c),e)return m=!0,E(e);h("Successfully read all files."),E(null,u)}}var y=c("read-file-list:sync");function b(e,t){var s,n,i,f,l;if(!r(e))throw new TypeError(d("0OD3s",e));for(n=arguments.length>1?t:{},f=e.length,s=new Array(f),y("Reading %d files...",f),l=0;l<f;l++){if(y("Reading file: %s (%d of %d).",e[l],l+1,f),(i=o(e[l],n))instanceof Error)return y("Encountered an error when reading file: %s (%d of %d). Error: %s",e[l],l,f,i.message),i;y("Successfully read file: %s (%d of %d).",e[l],l,f),s[l]={file:e[l],data:i}}return y("Finished reading files."),s}e(j,"sync",b);export{j as default,b as sync};
//# sourceMappingURL=index.mjs.map
